<!DOCTYPE html>
<html lang="en">
    <head>
        <title>比手畫腳 | 建北電資 28th</title>
    </head>
    <body>
        <style>
            input[type="number"] {
                width: 40px;
            }
            .gesture-game-box {
                margin: 20px auto;
            }
            .gesture-game-box > * {
                display: flex;
                justify-content: center;
                margin: 12px auto;
            }
            .question-text {
                font-size: 108px;
            }
        </style>
        <div class="gesture-game-box">
            <div class="question-text">
                比手畫腳
            </div>
            <div class="timer">
                <input type="number" id="time" value="5" />
                &nbsp;分鐘&nbsp;
                <input type="button" id="start" onclick="start();" value="開始" />
            </div>
            <div class="details">
                剩餘時間：
                <span class="time min">0</span>
                &nbsp;:&nbsp;
                <span class="time sec">45</span>
                &nbsp;&nbsp;
                答對的題目：
                <span class="score">0</span>
                &nbsp;&nbsp;
                <button id="skip" onclick="skip();">跳過</button>
                &nbsp;
                <button id="answer" onclick="answer();">答對了</button>
            </div>
        </div>
        <script>
            var questions = [
                "魔術方塊", "菸蒂", "操場", "筆電", "耳機", "混水摸魚", "煩惱"
            ];

            var setStyle = (element, key, value) => {
                element.style[key] = value;
            };

            var toggle = (selector, show) => {
                setStyle(
                    document.querySelector(selector),
                    "display", (show ? "" : "none")
                );
            };

            var setText = (text) => {
                document.querySelector(".question-text").innerHTML = text;
            };

            var shuffle = (array) => {
                for (let i = array.length - 1; i > 0; --i) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [ array[i], array[j] ] = [ array[j], array[i] ];
                }
            };

            toggle(".details", false);

            var endTime, endTimeout, index, score;

            var start = () => {
                toggle(".timer", false);
                toggle(".details", true);

                showSmallScore(0);

                shuffle(questions);

                var time = document.querySelector("input#time").value;

                index = 0, score = 0;

                showQuestion(index);

                var delay = time * 60 * 1000;
                endTime = new Date().getTime() + delay;
                endTimeout = setTimeout(end, delay);
            };

            var end = () => {
                toggle(".timer", true);
                toggle(".details", false);

                setText(`共答對 ${score} / ${index} 題`);
            };

            var showQuestion = (index) => {
                if (index >= questions.length) {
                    clearTimeout(endTimeout);
                    end();
                    return true;
                }

                setText(questions[index]);
            };

            var showSmallScore = (score) => {
                document.querySelector(".score").innerHTML = score;
            };

            var nextQuestion = () => {
                index++;
                showQuestion(index);
                showSmallScore(score);
            }

            var skip = () => {
                nextQuestion();
            };

            var answer = () => {
                score++;
                nextQuestion();
            };

            var showTime = () => {
                var timeLeft = new Date(endTime).getTime() - new Date().getTime();
                timeLeft = Math.ceil(timeLeft / 1000);

                document.querySelector(".time.min").innerHTML = Math.floor(timeLeft / 60);
                document.querySelector(".time.sec").innerHTML = (timeLeft % 60)
                    .toString().padStart(2, "0");

                window.requestAnimationFrame(showTime);
            }

            showTime();
        </script>
    </body>
</html>